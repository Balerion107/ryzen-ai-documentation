
.. include:: /icons.txt

#############
Runtime Setup
#############



*************************************
VitisAI EP / NPU Driver Compatibility
*************************************

The VitisAI EP requires a compatible version of the NPU drivers. For each version of the VitisAI EP, compatible drivers are bounded by a minimum version and a maximum release date. NPU drivers are backward compatible with VitisAI EP released up to 3 years before. The maximum driver release date is therefore set to 3 years after the release date of the corresponding VitisAI EP.

The table below summarizes the driver requirements for the different versions of the VitisAI EP.

.. list-table:: 
   :header-rows: 1

   * - VitisAI EP version
     - Minimum NPU Driver version
     - Maximum NPU Driver release date 
   * - 1.3.1
     - 32.0.201.242
     - January 17th, 2028
   * - 1.3
     - 32.0.201.237
     - November 26th, 2027
   * - 1.2
     - 32.0.201.204
     - July 30th, 2027



*****************
APU Types
*****************

The Ryzen AI Software supports different types of NPU-enabled APUs. These APU types are referred to as PHX, HPT, STX and KRK. 

To programmatically determine the type of the local APU, it is possible to enumerate the PCI devices and check for an instance with a matching Hardware ID.

.. list-table:: 
   :header-rows: 1

   * - Vendor
     - Device
     - Revision
     - APU Type
   * - 0x1022
     - 0x1502
     - 0x00
     - PHX or HPT 
   * - 0x1022
     - 0x17F0
     - 0x00
     - STX 
   * - 0x1022
     - 0x17F0
     - 0x10
     - STX 
   * - 0x1022
     - 0x17F0
     - 0x11
     - STX 
   * - 0x1022
     - 0x17F0
     - 0x20
     - KRK

.. _npu-configurations:

*******************************
NPU Configurations 
*******************************

.. note::

   For BF16 models the configurations files are automatically generated by the VAIML compiler. The user does not need to set the NPU binary file. 


The Ryzen AI Software currently supports two NPU configurations for INT8 models: the standard configuration and the benchmark configuration.

|warning| **IMPORTANT**: Selecting a NPU configuration is a mandatory step before running an application that usese INT8 model. A configurations is selected by loading the corresponding NPU binary file (.xclbin) in onnxruntime session. 


Standard Configuration
======================

The standard configuration is designed to minimize NPU hardware resource usage, featuring a smaller footprint on the NPU. 

The recommended configuration which should be used for most applications can be set using onnxruntime sessions as shown:

For STX/KRK APUs:

.. code-block::

   providers = ['VitisAIExecutionProvider']
   session = ort.InferenceSession(model, 
                                  providers = providers,
                                  provider_options=[{"config_file":"/path/to/vaip_config.json",
                                                   "xclbins":"%RYZEN_AI_INSTALLATION_PATH%/voe-4.0-win_amd64/xclbins/strix/AMD_AIE2P_Nx4_Overlay.xclbin"}])

For PHX/HPT APUs:

.. code-block::

   providers = ['VitisAIExecutionProvider']
   session = ort.InferenceSession(model, 
                                  providers = providers,
                                  provider_options=[{"config_file":"/path/to/vaip_config.json",
                                                   "xclbins":"%RYZEN_AI_INSTALLATION_PATH%/voe-4.0-win_amd64/xclbins/phoenix/1x4.xclbin"}])


Benchmark Configuration
=======================

The benchmark configuration maximizes NPU hardware resource usage, resulting in a larger footprint on the NPU. It is optimized for applications requiring high throughput and low latency from a single inference session.

|memo| **NOTE**: This configuration should only be used for testing Early Access features and for benchmarking purposes. Windows Studio Effects should be disabled when using this profile. To disable Windows Studio Effects, open Settings > Bluetooth & devices > Camera, select your primary camera, and then disable all camera effects.

To select this configuration, set the following environment variables based on your PC APU type:

For STX/KRK APUs:

.. code-block::

   providers = ['VitisAIExecutionProvider']
   session = ort.InferenceSession(model, 
                                  providers = providers,
                                  provider_options=[{"config_file":"/path/to/vaip_config.json",
                                                   "xclbins":"%RYZEN_AI_INSTALLATION_PATH%/voe-4.0-win_amd64/xclbins/strix/AMD_AIE2P_4x4_Overlay.xclbin"}])


For PHX/HPT APUs:

.. code-block::

   providers = ['VitisAIExecutionProvider']
   session = ort.InferenceSession(model, 
                                  providers = providers,
                                  provider_options=[{"config_file":"/path/to/vaip_config.json",
                                                   "xclbins":"%RYZEN_AI_INSTALLATION_PATH%/voe-4.0-win_amd64/xclbins/phoenix/4x4.xclbin"}])

.. _config-file:

**************************
Runtime Configuration File
**************************

The Vitis AI Execution Provider (VAI EP) requires a runtime configuration file. A default version of this runtime configuration file can be found in the Ryzen AI Software installation tree: :file:`%RYZEN_AI_INSTALLATION_PATH%\\voe-4.0-win_amd64\\vaip_config.json`. 

It is required to create a copy of the :file:`vaip_config.json` file in your project directory and use this copy when initializing the inference session. The Vitis AI EP and the runtime configuration file used by the application must be taken from the same Ryzen AI Software release package. Refer to the :doc:`modelrun` page for more details on how to set up an inference session with the Vitis AI EP.

